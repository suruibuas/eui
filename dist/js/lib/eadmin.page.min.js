/*!
 eadmin极速后台UI框架（我只想要个后台） | @author:317953536@qq.com 
*/
"use strict";var _createClass=function(){function n(t,a){for(var e=0;e<a.length;e++){var n=a[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,a,e){return a&&n(t.prototype,a),e&&n(t,e),t}}();function _classCallCheck(t,a){if(!(t instanceof a))throw new TypeError("Cannot call a class as a function")}var Page=function(){function n(t){if(_classCallCheck(this,n),null!=t.data){if(Mount.page=!0,this.window=null!=Mount.window?"#"+Mount.window:null,null!=(this.param=t).search&&(this.searchBox=null!=this.window?this.window+" "+t.search.boxid:t.search.boxid,this.searchBoxCache=$(this.searchBox)),null!=t.page){this.pageBox=null!=this.window?this.window+" "+t.page.boxid:t.page.boxid,this.pageBoxCache=$(this.pageBox),this.storeKey=md5(Eadmin.currentHref),this.page=1;var a=store(this.storeKey+"_page");null!=a&&(this.page=parseInt(a)),this.size=10,this.pageCount=null,this.get={};var e=store(this.storeKey+"_size");null!=e&&(this.param.page.size=parseInt(e)),this.size=this.param.page.size,this.get[this.param.page.page_field]=this.page,this.get[this.param.page.size_field]=this.size}this.tmpBox=scope('[data-template="'+this.param.tmp+'"]'),this.init=!1,this.run()}else console.log("自定义分页必须指定数据接口")}return _createClass(n,[{key:"run",value:function(){this._create(),this._event()}},{key:"_create",value:function(){var a=this,n=this,t=function(){if(null!=a.param.page){var t='<div class="table-page">\n\t\t\t\t\t\t\t\t<span class="info">\n\t\t\t\t\t\t\t\t\t共<em></em>条，每页\n\t\t\t\t\t\t\t\t\t<select name="pagesize" data-width="70">\n\t\t\t\t\t\t\t\t\t\t<option value="10"'+(10==a.size?" selected":"")+'>10</option>\n\t\t\t\t\t\t\t\t\t\t<option value="30"'+(30==a.size?" selected":"")+'>30</option>\n\t\t\t\t\t\t\t\t\t\t<option value="50"'+(50==a.size?" selected":"")+'>50</option>\n\t\t\t\t\t\t\t\t\t\t<option value="100"'+(100==a.size?" selected":"")+">100</option>\n\t\t\t\t\t\t\t\t\t</select>\n\t\t\t\t\t\t\t\t\t条，\n\t\t\t\t\t\t\t\t\t当前 <em>"+a.page+'</em>/<em>-</em> 页\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t<span class="prev-page"><i class="ri-arrow-left-s-line"></i></span>\n\t\t\t\t\t\t\t\t<span class="next-page"><i class="ri-arrow-right-s-line"></i></span>\n\t\t\t\t\t\t\t\t<span class="jump">\n\t\t\t\t\t\t\t\t\t跳转到第\n\t\t\t\t\t\t\t\t\t<input name="page" type="text" placeholder="页数">\n\t\t\t\t\t\t\t\t\t页\n\t\t\t\t\t\t\t\t\t<button class="highlight small">确定</button>\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t</div>';a.pageBoxCache.html(t)}};(function(){if(null!=a.param.search){var e='<div class="table-search">\n\t\t\t\t\t\t\t\t<form>\n\t\t\t\t\t\t\t\t\t<div class="block-box">';_.each(a.param.search.field,function(t,a){switch(e+='<div class="col-3">\n\t\t\t\t\t\t\t\t<div class="form-group">',t.type){case"input":e+='<div class="input-group">\n\t\t\t\t\t\t\t\t\t\t<span class="prepend">'+t.name+'</span>\n\t\t\t\t\t\t\t\t\t\t<input name="'+a+'" type="text" \n\t\t\t\t\t\t\t\t\t\t\tplaceholder="请输入'+t.name+'">\n\t\t\t\t\t\t\t\t\t</div>';break;case"datepicker":e+='<div class="input-group">\n\t\t\t\t\t\t\t\t\t\t<span class="prepend">'+t.name+'</span>\n\t\t\t\t\t\t\t\t\t\t<input \n\t\t\t\t\t\t\t\t\t\t\tid="table-datepicker-'+a+'" \n\t\t\t\t\t\t\t\t\t\t\tclass="table-datepicker"\n\t\t\t\t\t\t\t\t\t\t\tname="'+a+'" \n\t\t\t\t\t\t\t\t\t\t\ttype="text" \n\t\t\t\t\t\t\t\t\t\t\tplaceholder="请选择'+t.name+'">\n\t\t\t\t\t\t\t\t\t</div>';break;case"citypicker":e+='<div class="input-group">\n\t\t\t\t\t\t\t\t\t\t<span class="prepend">'+t.name+'</span>\n\t\t\t\t\t\t\t\t\t\t<input \n\t\t\t\t\t\t\t\t\t\t\tid="table-citypicker-'+a+'" \n\t\t\t\t\t\t\t\t\t\t\tclass="table-citypicker"\n\t\t\t\t\t\t\t\t\t\t\tname="'+a+'" \n\t\t\t\t\t\t\t\t\t\t\ttype="text" \n\t\t\t\t\t\t\t\t\t\t\tplaceholder="请选择'+t.name+'">\n\t\t\t\t\t\t\t\t\t</div>';break;case"select":e+='<select name="'+a+'" data-width="100%">\n\t\t\t\t\t\t\t\t\t\t<option value="'+module.conf.select_default_val+'">\n\t\t\t\t\t\t\t\t\t\t\t请选择'+t.name+"\n\t\t\t\t\t\t\t\t\t\t</option>",_.each(t.option,function(t){e+='<option value="'+t.val+'">\n\t\t\t\t\t\t\t\t\t\t\t'+t.key+"\n\t\t\t\t\t\t\t\t\t\t</option>"}),e+="</select>"}e+="</div></div>"}),e+='<div class="col-3">\n\t\t\t\t\t\t\t<button class="search-do highlight">\n\t\t\t\t\t\t\t\t<i class="ri-search-line"></i>搜索\n\t\t\t\t\t\t\t</button><button class="search-refresh">\n\t\t\t\t\t\t\t\t<i class="ri-refresh-line"></i>重置\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div></form></div>',a.searchBoxCache.prepend(e),a.searchBoxCache.find(".table-datepicker").each(function(){var t=$(this),a=t.attr("name"),e={};null!=n.param.search.field[a].param&&(e=n.param.search.field[a].param),Eadmin.datepicker("#"+t.attr("id"),e)}),a.searchBoxCache.find(".table-citypicker").each(function(){var t=$(this),a=t.attr("name"),e={};null!=n.param.search.field[a].param&&(e=n.param.search.field[a].param),Eadmin.citypicker("#"+t.attr("id"),e)})}})(),t(),this._loadData()}},{key:"_event",value:function(){var t=[".search-do",".search-refresh",".table-page select",".table-page .num-page:not(.current)",".table-page .prev-page",".table-page .next-page",".table-page button"],e=this,a=function(t){Eadmin.message.error({content:t}),e.pageBox.find("input").val("")};null!=e.param.search&&e.searchBoxCache.on("click",t[0],function(){e.page=1,e.get[e.param.page.page_field]=e.page;var t=e.searchBoxCache.find("form").serialize(),a=_.split(t,"&");return _.each(a,function(t){var a=_.split(t,"=");e.get[a[0]]=a[1]}),e._loadData(!0),!1}).on("click",t[1],function(){return e.searchBoxCache.find("input").val(""),Form.select(e.searchBoxCache),!1}),null!=e.param.page&&e.pageBoxCache.on("change",t[2],function(){e.page=1,e.size=parseInt($(this).val()),store(e.storeKey+"_page",e.page.toString()),store(e.storeKey+"_size",e.size.toString()),e.get[e.param.page.page_field]=e.page,e.get[e.param.page.size_field]=e.size,e._loadData(!0)}).on("click",t[3],function(){e.page=parseInt($(this).html()),store(e.storeKey+"_page",e.page.toString()),e.get[e.param.page.page_field]=e.page,e._loadData(!0)}).on("click",t[4],function(){1!=e.page&&(e.page-=1,store(e.storeKey+"_page",e.page.toString()),e.get[e.param.page.page_field]=e.page,e._loadData(!0))}).on("click",t[5],function(){e.page!=e.pageCount&&(e.page+=1,store(e.storeKey+"_page",e.page.toString()),e.get[e.param.page.page_field]=e.page,e._loadData(!0))}).on("click",t[6],function(){var t=e.pageBoxCache.find("input").val();""!=t?t<1?a("跳转的页数不能小于1"):t>e.pageCount?a("跳转的页数已经超出了最大页数"):t!=e.page?(store(e.storeKey+"_page",t),e.page=parseInt(t),e.get[e.param.page.page_field]=e.page,e._loadData(!0)):a("已经在待跳转的页面了"):a("跳转的页数不能为空")})}},{key:"_page",value:function(t){var a=1<arguments.length&&void 0!==arguments[1]&&arguments[1];if(null!=this.param.page)if(_.has(t,"count")){this.init||this.pageBoxCache.data("size",this.size);var e={count:this.pageBoxCache.find("em:first"),page:this.pageBoxCache.find("em").eq(1),pageCount:this.pageBoxCache.find("em").eq(2)};t.count==parseInt(e.count.html())&&this.size==this.pageBoxCache.data("size")||(t.count<this.size?this.pageCount=1:t.count%this.size==0?this.pageCount=t.count/this.size:this.pageCount=parseInt(t.count/this.size)+1,e.count.html(t.count),e.pageCount.html(this.pageCount),this.size!=this.pageBoxCache.data("size")&&this.pageBoxCache.data("size",this.size)),e.page.html(this.page);var n=10;_.has(this.param.page,"num")&&((n=this.param.page.num)<3&&(n=3),10<n&&(n=10));var i="",s=this.page,p=n+((s-=_.floor(n/2))<1?(s=1,0):this.page-_.floor(n/2)-1);p>this.pageCount&&(p=this.pageCount),p-s<n-1&&(s-=n-(p-s)-1),s<1&&(s=1);for(var o=s;o<=p;o++)i+='<span class="num-page'+(o==this.page?" current":"")+'" data-page="'+o+'">'+o+"</span>";this.pageBoxCache.find(".num-page").remove(),this.pageBoxCache.find(".prev-page").after(i),this.init&&a&&Eadmin.message.success({content:"当前第 "+this.page+" 页，共 "+this.pageCount+" 页"})}else console.log("数据源中未包含数据总条数count字段，创建分页失败")}},{key:"_loadData",value:function(){var e=this,n=0<arguments.length&&void 0!==arguments[0]&&arguments[0];Eadmin.loading("数据加载中，请稍候..."),n&&(this.tmpBox.empty(),null!=this.window?_.startsWith(this.window,"#tab")||($(this.window+" .body")[0].scrollTop=0):box[0].scrollTop=0),axios.get(this.param.data,{params:this.get}).then(function(t){var a={data:t.data};null!=a.data.count||null==e.param.page?null!=a.data.list?(Eadmin.template(e.param.tmp,a.data,function(){col(e.tmpBox),_.isFunction(e.param.callback)&&e.param.callback()}),e._page(a.data,n),Mount.page=!1,Eadmin.loadingHide(),e.init=!0):console.log("数据源中没有包含list字段"):console.log("返回的数据源中没有 count 字段，无法使用分页")}).catch(function(t){console.log(t)})}}]),n}();