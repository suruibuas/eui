/*!
 eadmin极速后台UI框架（我只想要个后台） | @author:317953536@qq.com 
*/
"use strict";var _createClass=function(){function o(t,n){for(var i=0;i<n.length;i++){var o=n[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(t,n,i){return n&&o(t.prototype,n),i&&o(t,i),t}}();function _classCallCheck(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}var Window=function(){function o(t,n){_classCallCheck(this,o),this.window="",this.windowDom=null,this.dom=0!=t&&scope(t),this.x=0,this.y=0,this.top=0,this.left=0;var i={url:"",model:"load",width:module.conf.window_width,height:module.conf.window_height,title:module.conf.window_title,drag:!0,btn:[],close:null,submit:null,style:"window"};this.param=$.extend(!0,i,n),this.run()}return _createClass(o,[{key:"run",value:function(){this._event()}},{key:"_create",value:function(){var i={id:createId(),width:0,height:0,style:"",drag:"",html:""};this.window="window-"+i.id,_.isInteger(this.param.width)||-1==this.param.width.indexOf("%")?i.width=this.param.width:i.width=innerW()*(parseInt(this.param.width.replace("%",""))/100),"popup"==this.param.style?i.height=innerH():_.isInteger(this.param.height)||-1==this.param.height.indexOf("%")?i.height=this.param.height:i.height=innerH()*(parseInt(this.param.height.replace("%",""))/100),"popup"==this.param.style?i.style='style="width:'+i.width+"px;height:"+i.height+'px;top:0;right:0;left:unset;border-radius:5px 0 0 5px;"':i.style='style="width:'+i.width+"px;height:"+i.height+"px;margin-left:-"+i.width/2+"px;margin-top:-"+i.height/2+'px;"',this.param.drag&&"window"==this.param.style&&(i.drag=' style="cursor: move;"'),i.height-=60,0<this.param.btn.length&&(i.height-=50),i.html='<div id="'+this.window+'" \n\t\t\t\t\t\tclass="window animated faster'+(null==Mount.window?"":" "+Mount.window)+' dn" '+i.style+'>\n\t\t\t\t\t<div class="window-loading dn">\n\t\t\t\t\t\t<i class="ri-loader-4-line rotate"></i>页面加载中，请稍候...\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="window-close">\n\t\t\t\t\t\t<i class="ri-close-circle-fill"></i>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="title"'+i.drag+">\n\t\t\t\t\t\t<span>"+this.param.title+'</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="body" style="height:'+i.height+'px;"></div>',0<this.param.btn.length&&(i.html+='<div class="btnbar">',_.each(this.param.btn,function(t){var n=-1==["cancel","refresh"].indexOf(t.action)?' data-loading="执行中..."':"";i.html+="<button\n\t\t\t\t\t\t\t\t"+(_.has(t,"highlight")?' class="highlight"':"")+"\n\t\t\t\t\t\t\t\t"+n+("submit"==t.action?" data-submit":"")+">\n\t\t\t\t\t\t\t"+t.name+"\n\t\t\t\t\t\t\t</button>"}),i.html+="</div>"),i.html+="</div>",body.append(i.html),this.windowDom=$("#"+this.window)}},{key:"_event",value:function(){var r=this,l={},s={close:function(){r.windowDom.remove(),Mount.window=null,$("."+r.window).remove(),Eadmin.maskHide(),null!=r.param.close&&_.isFunction(r.param.close)&&r.param.close()},load:function(){if("iframe"!=r.param.model){l.loading.show();var t=100;"popup"==r.param.style&&(t=200),setTimeout(function(){null!=l.scroll&&(l.scroll.destroy(),l.scroll=null),Mount.window=r.window,l.body.load(r.param.url,function(){l.loading.hide(),Eadmin.form(l.body),Button.run(r.windowDom),Status.run(l.body),Tag.run(l.body),Progress.run(l.body),l.scroll=Eadmin.scroll("#"+r.window+" .body");var t=body.find(".iscroll");0<t.length&&t.each(function(){if($(this).hasClass("ps"))return!0;Eadmin.scroll($(this)[0])}),block(l.body)})},t)}else{var n='<iframe \n\t\t\t\t\t\t\t\t\tsrc="'+r.param.url+'" \n\t\t\t\t\t\t\t\t\twidth="100%" \n\t\t\t\t\t\t\t\t\theight="100%" \n\t\t\t\t\t\t\t\t\tframeborder="0" scrolling="auto">\n\t\t\t\t\t\t\t\t</iframe>';l.body.html(n)}},init:function(t){if(r._create(),l={this:t,title:r.windowDom.children(".title"),body:r.windowDom.children(".body"),loading:r.windowDom.children(".window-loading"),scroll:null},0!=t&&(r.param.url=l.this.data("window-url")),Eadmin.currentHref=r.param.url,null!=r.param.url&&""!=r.param.url){var n=Eadmin.mask();0!=n&&r.windowDom.css("z-index",n),r.windowDom.off("animationend").show().addClass("window"==r.param.style?"zoomIn":"fadeInRight"),s.load(),r.windowDom.children(".window-close").on("click",function(){s.close()}),r.param.drag&&l.title.on("mousedown",function(t){var n=r.windowDom.offset();r.x=t.clientX,r.y=t.clientY,r.top=n.top,r.left=n.left;var o=r.windowDom.css("margin-left"),e=r.windowDom.css("margin-top");o=parseInt(o),e=parseInt(e),$(document).on("mousemove",function(t){var n=r.top+(t.clientY-r.y),i=r.left+(t.clientX-r.x);n-=e,i-=o,r.windowDom.css({top:n,left:i})})}).on("mouseup",function(){$(document).off("mousemove")}),0!=r.param.btn.length&&r.windowDom.children(".btnbar").children("button").on("click",function(){var a={this:$(this)};if(a.index=a.this.index(),a.param=r.param.btn[a.index],_.isString(a.param.action)){if(a.action=["cancel","refresh","submit"],-1==a.action.indexOf(a.param.action))return void console.log("没有找到内置按钮事件："+a.param.action);switch(a.param.action){case"cancel":s.close();break;case"refresh":l.body.empty(),s.load();break;case"submit":var t=function(){l.form=l.body.find("form"),0!=l.form.length?(l.action=l.form.attr("action"),null==l.action&&(l.action=r.param.url),Validate.submit(l.form),0<l.form.find("span.error").length||(Eadmin.button.loading(a.this),l.formData=l.form.serialize(),axios.post(l.action,l.formData).then(function(t){var n=t.data;if(null!=n[module.conf.http.code_field]){var i="";if(null!=n[module.conf.http.msg_field]&&(i=n[module.conf.http.msg_field]),n[module.conf.http.code_field]==module.conf.http.code_success){i=""==i?"操作执行成功":i;var o=l.form.find(".editor");if(0<o.length){var e=o.data("store");null!=e&&store.remove(e)}return s.close(!1),Eadmin.popup.success({content:i,callback:function(){!0===a.param.refresh_on_close&&Eadmin.refresh()}}),void Eadmin.button.reset(a.this)}""==i&&(i="操作执行失败"),Eadmin.message.error({content:i}),Eadmin.button.reset(a.this)}else console.log("接口返回结果中没有找到定义的code码字段")}).catch(function(t){Eadmin.message.error({content:t}),Eadmin.button.reset(a.this)}))):console.log("窗体内没有找到form表单元素，提交表单失败")};if(null!=a.param.before)return null==Method||null==Method[a.param.before]?(console.log("弹窗页面中没有找到指定的前置方法"+a.param.before),!1):void Method[a.param.before](t);t()}}else{var n=function(){setTimeout(function(){Eadmin.button.reset(a.this)},100)};a.param.action({close:function(){n(),s.close()},refresh:function(){n(),l.body.empty(),s.load()},btnReset:function(){n()}})}})}else console.log("没有指定弹窗地址，打开失败")}};0!=r.dom?r.dom.on("click",function(){s.init($(this))}):s.init(!1)}}]),o}();